# Test suite definitions for ifsnemo-compare
#
# Each suite groups related test commands under a single script.
# Pipeline YAML can override which suites to run via:
#   ifsnemo_compare:
#     test_suites: [compare_norms]

# Suites to run when pipeline YAML doesn't specify test_suites
default_suites:
  - compare_norms
  - bundle_validator

test_suites:
  compare_norms:
    working_dir: "{remote_path}/ifsnemo-build/ifsnemo-compare/tests/compare_norms"
    script: "python3 compare_norms.py"
    commands:
      run-tests:
        args: "-t {test_subdir}/ -ot {remote_path}/ifsnemo-build/ifsnemo/tests -r {resolution} -nt {threads} -p {ppn} -n {nodes} -s {steps}{gpu_flag}"
        output_prefix: "run_tests"
      compare:
        args: "-t {test_subdir}/ -ot {remote_path}/ifsnemo-build/ifsnemo/tests -g {gold_standard_tag}/ -og {remote_path}/ifsnemo-build/ifsnemo/references -r {resolution} -nt {threads} -p {ppn} -n {nodes} -s {steps}{gpu_flag}"
        output_prefix: "compare"
    sequence:
      - run-tests
      - compare

  bundle_validator:
    working_dir: "{remote_path}/ifsnemo-build/ifsnemo-compare/tests/bundle_validator"
    script: "python3 bundle_validator.py"
    commands:
      run-tests:
        args: "{bundle_yaml} {build_dir} -ot {remote_path}/ifsnemo-build/ifsnemo/tests/bundle_validator"
        output_prefix: "bundle_validate"
      compare:
        args: "-og {remote_path}/ifsnemo-build/ifsnemo/references/bundle_validator -ot {remote_path}/ifsnemo-build/ifsnemo/tests/bundle_validator"
        output_prefix: "bundle_compare"
    sequence:
      - run-tests
      - compare

# Declare required parameters - pipeline.py validates it provides these
required_params:
  - remote_path
  - test_subdir
  - gold_standard_tag
  - resolution
  - threads
  - ppn
  - nodes
  - steps
  - bundle_yaml
  - build_dir
